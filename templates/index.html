{% extends 'base.html' %}
{% block content %}

<div class="search-section">
  <h2>ðŸŒ¾ Welcome to AgriMarket PH</h2>
  <p>Find fresh, local farm products directly from trusted farmers.</p>
  
  <form method="get" action="/" class="search-bar">
    <input type="text" name="q" placeholder="Search products..." value="{{ request.args.get('q', '') }}">
    <input type="number" name="min" step="0.01" placeholder="Min price" value="{{ request.args.get('min', '') }}">
    <input type="number" name="max" step="0.01" placeholder="Max price" value="{{ request.args.get('max', '') }}">
    <button type="submit">Search</button>
  </form>
</div>

<h2 class="section-title">Latest Products</h2>
<div class="grid">
  {% for p in products %}
    <div class="card">
      <img src="{{ p.image_url() }}" alt="{{ p.name }}">
      <h3>{{ p.name }}</h3>
      <p class="small">{{ p.description[:80] }}{% if p.description|length > 80 %}...{% endif %}</p>
      <div class="card-bottom">
        <span class="price">â‚±{{ '%.2f'|format(p.price) }}</span>
        <a class="btn" href="{{ url_for('product_view', pid=p.id) }}">View</a>
      </div>
    </div>
  {% else %}
    <p class="no-products">No products yet. Try searching or come back later!</p>
  {% endfor %}
</div>

{% if current_user.is_authenticated and current_user.role == 'buyer' %}
<div class="info-box">
  <h3>ðŸ’¬ Need Help?</h3>
  <p>You can message farmers directly once you view a product page!</p>
</div>
{% endif %}

{% endblock %}

<style>

.search-section {
  text-align: center;
  margin: 30px auto;
  background: #f0fff0;
  padding: 20px;
  border-radius: 10px;
  max-width: 700px;
}
.search-section h2 {
  color: #2e8b57;
  font-weight: 700;
}
.search-section p {
  font-size: 0.95rem;
  color: #444;
}
.search-bar {
  margin-top: 15px;
}
.search-bar input {
  padding: 8px 10px;
  margin: 5px;
  border: 1px solid #ccc;
  border-radius: 5px;
  width: 150px;
}
.search-bar button {
  background-color: #2e8b57;
  color: #fff;
  border: none;
  padding: 8px 15px;
  border-radius: 5px;
  cursor: pointer;
}
.search-bar button:hover {
  background-color: #256b44;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 25px;
}
.card {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 15px;
  display: flex;
  flex-direction: column;
  transition: transform 0.2s ease;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}
.card img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 8px;
}
.card-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: auto;
}
.price {
  color: #2e8b57;
  font-weight: bold;
}
.no-products {
  text-align: center;
  color: #666;
  margin-top: 20px;
}

.info-box {
  background: #e8ffe8;
  border: 1px solid #b9deb9;
  border-radius: 10px;
  padding: 15px;
  margin: 30px auto;
  max-width: 700px;
  text-align: center;
}
</style>
